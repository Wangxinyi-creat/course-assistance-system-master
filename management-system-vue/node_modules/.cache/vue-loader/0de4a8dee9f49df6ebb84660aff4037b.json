{"remainingRequest":"D:\\a-project\\course-assistance-system-master\\management-system-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\a-project\\course-assistance-system-master\\management-system-vue\\src\\views\\personal\\index.vue?vue&type=style&index=0&id=1b92c146&scoped=true&lang=scss&","dependencies":[{"path":"D:\\a-project\\course-assistance-system-master\\management-system-vue\\src\\views\\personal\\index.vue","mtime":1713709431000},{"path":"D:\\a-project\\course-assistance-system-master\\management-system-vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\a-project\\course-assistance-system-master\\management-system-vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\a-project\\course-assistance-system-master\\management-system-vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\a-project\\course-assistance-system-master\\management-system-vue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\a-project\\course-assistance-system-master\\management-system-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\a-project\\course-assistance-system-master\\management-system-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpAaW1wb3J0ICcuL2luZGV4LnNjc3MnOwo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoWA","file":"index.vue","sourceRoot":"src/views/personal","sourcesContent":["<template>\n  <div class=\"personal\">\n    <!-- 用户信息 -->\n    <el-row :gutter=\"15\">\n      <el-col :md=\"24\" :lg=\"16\" :xl=\"16\" class=\"mb15\">\n        <el-card shadow=\"hover\">\n          <div slot=\"header\">\n            <span>我的工作台</span>\n          </div>\n          <div class=\"user-item\">\n            <div class=\"user-item-left\">\n              <el-upload class=\"h100 personal-user-left-upload\"\n                         :action=\"baseURL\"\n                         :show-file-list=\"false\"\n                         :on-success=\"handleAvatarSuccess\"\n                         :before-upload=\"beforeAvatarUpload\">\n                <img :src=\"getUserInfos.headSrc\"/>\n              </el-upload>\n            </div>\n            <div class=\"user-item-right overflow\">\n              <el-row>\n                <el-col :span=\"24\" class=\"right-title mb15 one-text-overflow\"\n                >{{ currentTime }}，{{ getUserInfos.userName }}，{{ dailyMessage }}\n                </el-col>\n                <el-col :span=\"24\">\n                  <el-col :xs=\"12\" :sm=\"12\" :md=\"8\" class=\"right-l-v\">\n                    <div class=\"right-label\">昵称：</div>\n                    <div class=\"right-value\">{{ getUserInfos.nickName }}</div>\n                  </el-col>\n                  <el-col :xs=\"12\" :sm=\"12\" :md=\"16\" class=\"right-l-v\">\n                    <div class=\"right-label\">身份：</div>\n                    <div class=\"right-value\">\n                      {{ getUserInfos.identity }}\n                    </div>\n                  </el-col>\n                </el-col>\n                <el-col :span=\"24\" class=\"mt5\" v-if=\"getUserInfos.identity === '学生'\">\n                  <el-col :xs=\"12\" :sm=\"12\" :md=\"8\" class=\"right-l-v\">\n                    <div class=\"right-label one-text-overflow\">专业：</div>\n                    <div class=\"right-value one-text-overflow\">{{ getUserInfos.major }}</div>\n                  </el-col>\n                  <el-col :xs=\"12\" :sm=\"12\" :md=\"16\" class=\"right-l-v\">\n                    <div class=\"right-label one-text-overflow\">班级：</div>\n                    <div class=\"right-value one-text-overflow\">{{ getUserInfos.major }}</div>\n                  </el-col>\n                </el-col>\n                <el-col :span=\"24\" class=\"mt5\">\n                  <el-col :xs=\"12\" :sm=\"12\" :md=\"8\" class=\"right-l-v\">\n                    <div class=\"right-label one-text-overflow\">IP：</div>\n                    <div class=\"right-value one-text-overflow\">{{ IP }}</div>\n                  </el-col>\n                  <el-col :xs=\"12\" :sm=\"12\" :md=\"16\" class=\"right-l-v\">\n                    <div class=\"right-label one-text-overflow\">时间：</div>\n                    <div class=\"right-value one-text-overflow\">{{ userInfo.time }}</div>\n                  </el-col>\n                </el-col>\n              </el-row>\n            </div>\n          </div>\n        </el-card>\n      </el-col>\n      <!--消息通知-->\n      <el-col :md=\"24\" :lg=\"8\" :xl=\"8\" class=\"mb15\">\n        <el-card shadow=\"hover\">\n          <div slot=\"header\">\n            <span>消息通知</span>\n            <el-button class=\"personal-card-more\" type=\"text\" v-if=\"newsInfoList.length>0\"\n                       @click=\"onOpenNotice\">更多\n            </el-button>\n          </div>\n          <div class=\"info\">\n            <Scroll :data=\"newsInfoList\" class=\"info-scroll\" :class-option=\"optionSingleHeight\">\n              <ul class=\"info-ul\" v-if=\"newsInfoList.length>0\">\n                <li v-for=\"(v, k) in newsInfoList\" :key=\"k\" class=\"info-item\"\n                    @click=\"onNewsInfoListClick(v)\">\n                  <div class=\"info-item-left\"\n                       v-text=\"(v.noticeType===1?'[通知]':'[公告]')+v.noticeTitle\"></div>\n                  <div class=\"info-item-right\" v-text=\"v.createTime\"></div>\n                </li>\n              </ul>\n              <el-empty description=\"暂无消息通知\" v-else :image-size=\"50\"></el-empty>\n            </Scroll>\n          </div>\n        </el-card>\n      </el-col>\n      <!-- 更新信息 -->\n      <el-col :span=\"24\">\n        <el-card shadow=\"hover\" class=\"personal-edit\" header=\"更新信息\">\n          <div class=\"personal-edit-title\">\n            <span>基本信息</span>\n            <el-button class=\"personal-card-more\" type=\"text\" @click=\"replace()\" v-if=\"!replaceFlag\">\n              更新个人信息\n            </el-button>\n            <el-button class=\"personal-card-more\" type=\"text\" @click=\"replace()\" v-else>取 消</el-button>\n          </div>\n          <el-form :model=\"personalForm\" size=\"small\" label-width=\"40px\" class=\"mt35 mb35\"\n                   :disabled='!replaceFlag'>\n            <el-row :gutter=\"35\">\n              <el-col :xs=\"24\" :sm=\"12\" :md=\"8\" :lg=\"6\" :xl=\"4\">\n                <el-form-item label=\"昵称\">\n                  <el-input v-model=\"personalForm.nickName\" placeholder=\"请输入昵称\"\n                            clearable></el-input>\n                </el-form-item>\n              </el-col>\n              <el-col :xs=\"24\" :sm=\"12\" :md=\"8\" :lg=\"6\" :xl=\"4\">\n                <el-form-item label=\"邮箱\">\n                  <el-input v-model=\"personalForm.email\" placeholder=\"请输入邮箱\"\n                            clearable></el-input>\n                </el-form-item>\n              </el-col>\n              <el-col :xs=\"24\" :sm=\"12\" :md=\"8\" :lg=\"6\" :xl=\"4\">\n                <el-form-item label=\"手机\">\n                  <el-input v-model=\"personalForm.phone\" placeholder=\"请输入手机\"\n                            clearable></el-input>\n                </el-form-item>\n              </el-col>\n              <el-col :xs=\"24\" :sm=\"12\" :md=\"8\" :lg=\"6\" :xl=\"4\">\n                <el-form-item label=\"性别\">\n                  <el-select v-model=\"personalForm.sex\" placeholder=\"请选择性别\" clearable\n                             class=\"w100\">\n                    <el-option label=\"男\" :value=\"1\"></el-option>\n                    <el-option label=\"女\" :value=\"2\"></el-option>\n                  </el-select>\n                </el-form-item>\n              </el-col>\n              <el-col :xs=\"24\" :sm=\"12\" :md=\"8\" :lg=\"6\" :xl=\"4\" v-if=\"replaceFlag\">\n                <el-form-item>\n                  <el-button type=\"primary\" icon=\"el-icon-edit\" @click=\"replaceSave\">提交更新\n                  </el-button>\n                </el-form-item>\n              </el-col>\n            </el-row>\n          </el-form>\n          <div class=\"personal-edit-title\">账号安全</div>\n          <div class=\"personal-edit-safe-box\">\n            <div class=\"personal-edit-safe-item\">\n              <div class=\"personal-edit-safe-item-left\">\n                <div class=\"personal-edit-safe-item-left-label\">账户密码</div>\n              </div>\n              <div class=\"personal-edit-safe-item-right\">\n                <el-button text type=\"primary\" size=\"small\" @click=\"dialogVisible = true\">立即修改\n                </el-button>\n              </div>\n            </div>\n          </div>\n        </el-card>\n      </el-col>\n    </el-row>\n    <!--修改密码-->\n    <el-dialog\n        title=\"修改密码\"\n        :close-on-click-modal=\"false\"\n        :visible.sync=\"dialogVisible\"\n        :before-close=\"reset\"\n        width=\"35%\">\n      <el-form ref=\"userDialogFormRef\" :model=\"modifyPwdForm\" :rules=\"rules\" size=\"default\" label-width=\"100px\">\n        <el-form-item label=\"旧密码\" prop=\"oldPassword\">\n          <el-input v-model=\"modifyPwdForm.oldPassword\"\n                    placeholder=\"请输入旧密码\"\n                    show-password\n                    clearable\n                    maxlength=\"16\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"新密码\" prop=\"newPassword1\">\n          <el-input v-model=\"modifyPwdForm.newPassword1\"\n                    placeholder=\"请输入新密码\"\n                    show-password\n                    clearable\n                    maxlength=\"16\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"确认新密码\" prop=\"newPassword2\">\n          <el-input v-model=\"modifyPwdForm.newPassword2\"\n                    placeholder=\"请重新输入新密码\"\n                    show-password\n                    clearable\n                    maxlength=\"16\"></el-input>\n        </el-form-item>\n      </el-form>\n      <template #footer>\n\t\t\t\t<span class=\"dialog-footer\">\n\t\t\t\t\t<el-button @click=\"reset()\" size=\"small\">取 消</el-button>\n\t\t\t\t\t<el-button type=\"primary\" @click=\"onSubmit\" size=\"small\">确定</el-button>\n\t\t\t\t</span>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport Scroll from 'vue-seamless-scroll';\nimport {Session} from '@/utils/storage';\nimport {formatAxis, formatDate} from '@/utils/style/formatTime';\nimport {dailyMessage} from './mock';\nimport {updatePersonal, updatePwd} from \"@/api/system/user\";\nimport {Message} from \"element-ui\";\nimport {getNotice} from \"@/api/system/notice\";\nimport {CheckNoticeRouter} from \"@/utils/addRouter\";\nimport axios from \"axios\";\n\nexport default {\n  name: 'personal',\n  components: {Scroll},\n  data() {\n    return {\n      baseURL: process.env.VUE_APP_APIUPLOAD,\n      newsInfoList: [],\n      userInfo: {},\n      dailyMessage: {},\n      replaceFlag: false,\n      personalForm: {},\n      dialogVisible: false,\n      modifyPwdForm: {},\n      IP: '',\n      rules: {\n        oldPassword: [{required: true, message: '请输入旧密码', trigger: 'blur'}],\n        newPassword1: [{required: true, message: '请输入新密码', trigger: 'blur'}],\n        newPassword2: [{required: true, message: '请输入确认新密码', trigger: 'blur'}],\n      }\n    };\n  },\n  created() {\n    this.personalForm = {...this.$store.state.userInfos.userInfos.user}\n    this.getNotice();// 获取消息通知\n    this.initUserInfo();// 初始化登录信息\n    this.initDailyMessage();// 随机语录\n    //获取ip\n    axios.get('http://api.ipify.org?format=json').then(response => {\n      this.IP = response.data.ip\n    })\n  },\n  computed: {\n    currentTime() {\n      return formatAxis(new Date());\n    },\n    optionSingleHeight() {\n      return {\n        singleHeight: 28,\n        limitMoveNum: 8,\n        waitTime: 2000,\n      };\n    },\n    getUserInfos() {\n      return this.$store.state.userInfos.userInfos.user;\n    },\n  },\n  methods: {\n    // 随机语录\n    initDailyMessage() {\n      this.dailyMessage = dailyMessage[Math.floor(Math.random() * dailyMessage.length)];\n    },\n    // 初始化登录信息\n    initUserInfo() {\n      if (!Session.get('userInfo')) return false;\n      this.userInfo = Session.get('userInfo');\n      this.userInfo.time = formatDate(new Date(this.userInfo.time), 'YYYY-mm-dd HH:MM:SS');\n    },\n    replace() {\n      this.replaceFlag = !this.replaceFlag\n      this.personalForm = {...this.$store.state.userInfos.userInfos.user}\n    },\n    getNotice() {\n      const param = {\n        status: 1,\n        pageNum: 1,\n        pageSize: 10,\n      }\n      getNotice(param).then(res => {\n        this.newsInfoList = res.data.list;\n      })\n    },\n    /**\n     * 提交个人信息修改\n     */\n    replaceSave() {\n      updatePersonal(this.personalForm).then(res => {\n        if (res.code === 200) {\n          //更新vuex数据\n          this.loadVueX()\n          this.$notify.success({\n            title: '提示',\n            message: '修改成功'\n          });\n        }\n      })\n      this.replaceFlag = false\n    },\n    /**\n     * 更新vuex数据\n     */\n    loadVueX() {\n      const userInfos = {\n        user: this.personalForm,\n        time: new Date().getTime(),\n        authBtnList: this.$store.state.userInfos.userInfos.authBtnList,\n      };\n      this.$store.dispatch('userInfos/setUserInfos', userInfos);\n      Session.set('userInfo', userInfos);\n    },\n    /**\n     * 图片上传成功回调\n     * @param res\n     * @param file\n     */\n    handleAvatarSuccess(res, file) {\n      this.personalForm.headSrc = res.data;\n      this.replaceSave()\n    },\n    /**\n     * 图片上传前调用\n     * @param file\n     * @returns {boolean}\n     */\n    beforeAvatarUpload(file) {\n      const isPNG = file.type === 'image/png';\n      const isJPG = file.type === 'image/jpeg';\n      const isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isJPG && !isPNG) {\n        Message.error('上传头像图片只能是 JPG 或 PNG 格式!');\n      }\n      if (!isLt2M) {\n        Message.error('上传头像图片大小不能超过 2MB!');\n      }\n      const isIMG = isJPG || isPNG\n      return isIMG && isLt2M;\n    },\n    onSubmit() {\n      updatePwd(this.getUserInfos.id, this.modifyPwdForm).then(res => {\n        if (res.code === 200) {\n          this.$notify.success({\n            title: '提示',\n            message: '修改成功'\n          });\n          this.dialogVisible = false\n        }\n      })\n    },\n    // 消息通知当前项点击\n    onNewsInfoListClick(v) {\n      CheckNoticeRouter()//查询公告详情路由\n      this.$router.push({name: 'checkNotice', query: {id: v.noticeId}})\n    },\n    // 跳转到通知公告\n    onOpenNotice() {\n      this.$router.push('/notice');\n    },\n    reset() {\n      this.dialogVisible = false\n      this.$refs.userDialogFormRef.resetFields()\n      this.modifyPwdForm = {}\n    }\n  },\n};\n</script>\n\n<style scoped lang=\"scss\">\n@import './index.scss';\n</style>\n"]}]}